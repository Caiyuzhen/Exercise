/* 
	æµçš„æœºåˆ¶
		NodeJS çŽ¯å¢ƒ => Stream
			å¯åº¦æµ ReadableStream
			å¯å†™æµ WritableStream
			è½¬æ¢æµ TransformStream
			åŒå·¥æµ DuplexStream

		æµè§ˆå™¨çŽ¯å¢ƒ => Web Stream
			å¯è¯»æµ ReadableStream
			å¯å†™æµ WritableStream
			è½¬æ¢æµ TransformStream

			How?
				ã€æµè§ˆå™¨ç«¯ã€‘å‘é€æµæ•°ç»„
					ç”¨ FormData æˆ– Blob å¯¹è±¡åŽ»ã€è®¾ç½®è¯·æ±‚ä½“ã€‘çš„è¯, å‘é€æ•°æ®ä¼šè‡ªåŠ¨çš„ä½¿ç”¨æµçš„æ–¹å¼åŽ»å‘é€(æ— è®ºæ˜¯ Ajax è¿˜æ˜¯ Fetch)
					å¦‚æžœç›´æŽ¥æ˜¯ç”¨ã€å®šåž‹æ•°ç»„ ArrayBuffer ã€‘ç­‰äºŒè¿›åˆ¶çš„æ–¹å¼åŽ»è®¾ç½®çš„è¯, å°±ä¸ä¼šä½¿ç”¨æµçš„æ–¹å¼åŽ»å‘é€

				ã€æµè§ˆå™¨ç«¯ã€‘æŽ¥æ”¶æµæ•°ç»„
					Ajax æ–¹æ³• => è®¾ç½® responseType å±žæ€§ä¸º arrayBuffer æˆ– blob æ¥èŽ·å–äºŒè¿›åˆ¶æ•°æ®æµ
					Fetch æ–¹æ³• => è®¾ç½® Response.body å±žæ€§, å®ƒæ˜¯ä¸€ä¸ª ReadableStream å¯¹è±¡, å¯ä»¥ä½¿ç”¨å®ƒæ¥å¤„ç†æ•°æ®

				ã€NodeJS ç«¯ã€‘
					å¯è¯»æµ
						read([size]) : ä»Žå†…éƒ¨ç¼“å†²åŒºè¯»å–å¹¶è¿”å›žä¸€äº›æ•°æ®, å¦‚æžœæ²¡æœ‰æ•°æ®å¯è¯», åˆ™è¿”å›ž null
						setEncoding(encoding) : è®¾ç½®æµçš„å­—ç¬¦ç¼–ç , ä¹‹åŽä»Žæµä¸­è¯»å–çš„å­—ç¬¦ä¸²å°†è‡ªåŠ¨ä»¥æ­¤ç¼–ç æ¥è§£ç 
						pause() : æš‚åœè¯»å–æ•°æ® => æš‚åœ 'data' äº‹ä»¶
						resume() : æ¢å¤è¯»å–æ•°æ® => æ¢å¤ 'data' äº‹ä»¶
						pipe(destination[, options]) : å°†å¯è¯»æµçš„è¾“å‡ºå†…å®¹å†™å…¥åˆ°å¯å†™æµä¸­ ðŸŒŸ
						'data'äº‹ä»¶ï¼š å½“æœ‰æ•°æ®ã€å¯è¯»ã€‘æ—¶è§¦å‘ ðŸŒŸ
						'end'äº‹ä»¶ï¼š å½“æ²¡æœ‰æ›´å¤šçš„æ•°æ®ã€å¯è¯»ã€‘æ—¶è§¦å‘ ðŸŒŸ
						'error'äº‹ä»¶ï¼š å½“åœ¨æŽ¥æ”¶å’Œå†™å…¥æ•°æ®çš„è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘

					å¯å†™æµ
						write(chunk, [, encoding][, callback]) : å°†æ•°æ®å†™å…¥åˆ°æµä¸­, å¦‚æžœç¼“å†²åŒºå·²æ»¡, åˆ™è¿”å›ž falseï¼Œ å¦åˆ™ true
						end([chunk][, encoding][, callback]) : ç»“æŸå†™å…¥æµ, å¦‚æžœæŒ‡å®šäº† chunkï¼Œåˆ™ç›¸å½“äºŽå…ˆè°ƒç”¨ write(chunk, encoding) ç„¶åŽå†è°ƒç”¨ end(callback)
						cork(): å¼ºåˆ¶å°†æ‰€æœ‰å†™å…¥çš„æ•°æ®å­˜å…¥å†…å­˜ç¼“å†²åŒº, ç›´åˆ°è°ƒç”¨ uncork() æˆ– end() æ–¹æ³•
						uncork(): å°†ç¼“å†²åŒºçš„æ‰€æœ‰æ•°æ®è¿›è¡Œè¾“å‡º
						'drain'äº‹ä»¶ : å¦‚æžœè°ƒç”¨ write() æ–¹æ³•åˆ™è¿”å›ž false, å½“å¯ä»¥ç»§ç»­å†™å…¥æ•°æ®åˆ°æµä¸­æ—¶ä¼šè§¦å‘æ­¤äº‹ä»¶, æˆ‘ä»¬å¯ä»¥ç›‘å¬æ­¤äº‹ä»¶æ¥æŒ‡å¯¼ä½•æ—¶å¯ä»¥ç»§ç»­å†™å…¥æ•°æ®
						'finish'äº‹ä»¶ : å½“è°ƒç”¨ end() æ–¹æ³•å¹¶ä¸”ç¼“å†²åŒºæ•°æ®éƒ½å·²ç»è¾“å‡ºæ—¶è§¦å‘
						'error'äº‹ä»¶ : å½“åœ¨æŽ¥æ”¶å’Œå†™å…¥æ•°æ®çš„è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶è§¦å‘
*/

const http = require('http');
const fs = require('fs')

const server = http.createServer((req, res) => {
	// ðŸ‘‡ä»¥å¯è¯»æµçš„æ–¹å¼å¤„ç†ç½‘ç»œè¯·æ±‚ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
	// å“åº”å¤´
	res.writeHead(200, {'ContentType': 'text/paint'});;
	// å¤„ç†è¯·æ±‚æ•° => ä»¥æµçš„æ–¹æ³•
	req.on('data', (chunk) => {
		// å†™å…¥æ–‡ä»¶æˆ–è€…ä¼ å…¥åˆ°å…¶ä»–æœåŠ¡å™¨
		// ...
	})

	// è¯·æ±‚æ•°æ®å¤„ç†å®Œæ¯•
	req.on('end', () => {
		// å“åº”æ•°æ®
		res.end('Data received successfully!');
	})




	// ðŸ‘‡ä»¥å¯è¯»æµçš„æ–¹å¼å¤„ç†æ–‡ä»¶ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
	const readStream = fs.createReadStream(path.join(__dirname, 'data.txt'), 'utf8');
	readStream.on('data', chunk => {
		// å¤„ç†æ•°æ®æµ
		// ...
	})

	readStream.on('end', () => {
		// æ–‡ä»¶è¯»å–ç»“æŸ
		// ...
	})




	// ðŸ‘‡ä»¥å¯å†™æµçš„æ–¹å¼å¤„ç†æ–‡ä»¶ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
	const writeStream = fs.createWriteStream('output.txt');
	writeStream.write('Hello World!', 'utf8');
	writeStream.end();




	// ðŸ”¥å¯è¯»ã€å¯å†™æµçš„ç»„åˆæ–¹å¼ ðŸ”¥ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
	// ðŸ‘‡ æ–‡ä»¶ => è¯»å–åˆ°ç¼“å†²åŒº => ä»Žç¼“å†²åŒºå†™å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶
	const readStream2 = fs.createWriteStream('input.txt');
	const writeStream2 = fs.createWriteStream('output.txt');

	readStream2.pipe(writeStream2); // ä»¥ç®¡é“çš„æ–¹å¼å¤„ç†æ•°æ®æµ, æŠŠè¯»å–çš„æ•°æ®æµç›´æŽ¥å†™å…¥åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ => å¯åº¦æµè½¬ä¸ºå¯å†™æµ

	writeStream2.on('drain', () => { // drain è¡¨ç¤ºä½ŽäºŽã€ç¼“å†²åŒºçš„ä¸Šé™ã€‘äº†, å°±å¯ä»¥ç»§ç»­è¯»å–æ•°æ®
		readStream2.resume(); // resume æ¢å¤è¯»å–æ•°æ®åˆ°ç¼“å†²åŒº!!!
	});

	readStream2.on('data', chunk => {
		if(!writeStream2.write(chunk)) { // ðŸ”¥è¿™é‡Œçš„ write æŒ‡çš„æ˜¯å†™å…¥ç¼“å†²åŒº, å¦‚æžœå†™ä¸è¿›åŽ»å°±æ˜¯åˆ°äº†ã€ç¼“å†²åŒºçš„ä¸Šé™ã€‘, å°±ä¼šè§¦å‘ drain äº‹ä»¶, å°±æš‚åœè¯»å–æ•°æ®
			readStream2.pause();
		}
	})
})


server.listen(3030, () => {
	console.log('Server listening on: http://localhost:3030');
})