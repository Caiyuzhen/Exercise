/*
	Then æ–¹æ³•
		æ¯ä¸ª Promise çš„å®žä¾‹éƒ½å¯ä»¥è°ƒç”¨ then æ–¹æ³•
			Promise.prototype.then

		ðŸŒŸå¯ä»¥ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼ˆä¸¤ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°, éƒ½æ˜¯å¼‚æ­¥çš„å‡½æ•°ï¼ï¼ï¼‰, ä¹Ÿå¯ä»¥ä¸ä¼ 
			ç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯ resolve() æ‰§è¡ŒåŽæ‰ä¼šè¢«æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ --- å¼‚æ­¥ä»£ç ï¼
			ç¬¬äºŒä¸ªå‡½æ•°æ˜¯ reject() æ‰§è¡ŒåŽæ‰ä¼šè¢«æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ --- å¼‚æ­¥ä»£ç ï¼

		ðŸŒŸthen æ–¹æ³•ä¹Ÿä¼šè¿”å›žä¸€ä¸ª Promise å®žä¾‹
			ðŸ”¥then() æ–¹æ³•æ— è®ºæ‰§è¡Œçš„æ˜¯ handleResolve() è¿˜æ˜¯ handleReject() , è¿”å›žçš„ Promise å®žä¾‹çš„ [[PromiseState]] éƒ½ä¼šå˜æˆ fullfilled !!!
		
	æ€»ç»“
		âš¡ï¸å¦‚æžœå½“å‰ then æ²¡æœ‰ç›¸åº”çš„å¤„ç†å‡½æ•°ï¼ˆresolve,rejectï¼‰ï¼Œé‚£ä¹ˆã€è¿›åº¦çŠ¶æ€ã€‘å’Œã€ç»“æžœæ•°æ®ã€‘éƒ½ä¼šåŽŸæ ·ç»§æ‰¿ä¸Šä¸€ä¸ª then çš„ã€çŠ¶æ€ã€‘å’Œã€æ•°æ®ã€‘
		
		âš¡ï¸åªè¦ then ã€å†™äº†ã€‘ç›¸åº”çš„å¤„ç†å‡½æ•°ï¼ˆresolve,rejectï¼‰ï¼Œåªè¦å‡½æ•°æ²¡æŠ¥é”™, å®žä¾‹çš„ã€è¿›åº¦çŠ¶æ€ã€‘ä¸€å®šæ˜¯ fullfilled, æ•°æ®éƒ½æ˜¯å½“å‰ then çš„ (resolve,reject) çš„è¿”å›žå€¼
		
		âš¡ï¸å¦‚æžœ promise å®žä¾‹é“¾ä¸Šçš„æœ€åŽä¸€ä¸ªå®žä¾‹æœ€ç»ˆæ˜¯ reject çŠ¶æ€, é‚£ä¹ˆæ•´ä¸ªä»£ç å°±ä¼šæŠ¥é”™, å› ä¸ºä¸Šä¸€å±‚æ²¡æœ‰å¤„ç† reject çŠ¶æ€éœ€è¦åšä»€ä¹ˆ, æŠ¥é”™ä¿¡æ¯ä¸­ä¼šåŒ…å«å®žä¾‹çš„æ•°æ®

		âš¡ï¸å¦‚æžœ then å†… return new äº†ä¸€ä¸ª Promise, é‚£ä¹ˆè¿™ä¸ª Promise çš„ã€è¿›åº¦çŠ¶æ€ã€‘è·Ÿã€ç»“æžœæ•°æ®ã€‘ä¼šè·Ÿå½“å‰çš„ then ä¿æŒä¸€è‡´!!!
*/ 


//å®šä¹‰ä¸€ä¸ªå‘é€è¯·æ±‚çš„æ–¹æ³• â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
function getData(url, data, cb){
	const randomDelay = Math.random().toFixed(3) * 1000 //
	setTimeout(()=>{
		cb()
	},randomDelay)
}



//ç¬¬ä¸€ä¸ª Promise å®žä¾‹ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
const PROMIES = new Promise((resolve,reject)=>{
	//âš¡ï¸æ‰§è¡ŒèŽ·å–æ•°æ®çš„æ–¹æ³•
	getData('http://localhost:3000/api', 'abc', (data)=>{
		//âš¡ï¸åœ¨å›žè°ƒå†…æ‰§è¡Œ resolve æˆ– reject, è¿™æ—¶å€™ data å°±å˜æˆ Promise çš„ç»“æžœå€¼ [[PromiseResult]]
		resolve(data) //data å°±æ˜¯ PROMISE çš„å€¼
	})
	//â°è®¾ç½®å»¶è¿Ÿæ—¶é—´çš„æ–¹æ³•
	// setTimeout(()=>{
	// 	resolve(data)
	// },3000)
})


PROMIES.then( //ðŸŒŸðŸŒŸ then æ–¹æ³•å†…ä¼ å…¥çš„å‡½æ•°éƒ½æ˜¯å¼‚æ­¥å‡½æ•°
	/*ðŸŒŸthen æ–¹æ³•ä¹Ÿä¼šè¿”å›žä¸€ä¸ª Promise å®žä¾‹,è¿”å›žçš„ Promise å®žä¾‹çš„ [[PromiseState]] éƒ½ä¼šå˜æˆ fullfilled !!!*/
	(res)=>{ //ðŸ”¥ðŸ”¥ðŸ”¥è¿™æ—¶å€™ res å°±æ˜¯ä¸Šé¢çš„ data çš„æ•°æ®ï¼ï¼
		/*
		ä¹Ÿå¯ä»¥ä¸ä¼ è¿™ä¸ªæ–¹æ³•,ç”¨ä¸€ä¸ª undefined æ¥é¡¶ç€, ä¸ä¼ çš„è¯å°±æ˜¯ä¸Šé¢é‚£ä¸ª Promise çš„ resolve('å•¦å•¦å•¦')çš„å€¼, çŠ¶æ€ä¹Ÿè·Ÿä¸Šé¢çš„ Promise ä¸€æ ·
		resolve() æ‰§è¡ŒåŽæ‰ä¼šè¢«æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­
		å¯ä»¥å«ä½œ handleResolve(), ðŸŒŸ æ˜¯ä¸‹ä¸€æ­¥çœŸæ­£è¦åšçš„ä»£ç 
		console.log(2)
		*/
	},
	()=>{	
		//reject() æ‰§è¡ŒåŽæ‰ä¼šè¢«æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­
		//å¯ä»¥å«ä½œ handleReject(), æ˜¯ç”¨äºŽå¤„ç† reject çš„é”™è¯¯
	}
)



//ðŸ”¥ Promise å®žä¾‹é“¾ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

//å¯ä»¥ç”¨ä¸€ä¸ªå˜é‡åŽ»æŽ¥æ”¶ .then() æ–¹æ³•è¿”å›žçš„ Promise å®žä¾‹
const P2 = PROMIES.then(
	//ðŸ‘‡éƒ½æ˜¯æ ¹æ®å‰ä¸€ä¸ªå®žä¾‹çš„çŠ¶æ€æ¥å†³å®šæ‰§è¡Œ resolve() è¿˜æ˜¯ reject()
	(res)=>{return 666},  //ðŸŒŸðŸŒŸå¯ä»¥æœ‰å‚æ•°, res å°±æ˜¯ä¸Šä¸€ä¸ª Promise çš„è¿”å›žå€¼(ä¸€æ ·çš„)ï¼ï¼
	(err)=>{} 		//ðŸŒŸðŸŒŸå¯ä»¥æœ‰å‚æ•°, err å°±æ˜¯ä¸Šä¸€ä¸ª Promise çš„è¿”å›žå€¼(ä¸€æ ·çš„)ï¼ï¼
)


//è¿˜å¯ä»¥ç»§ç»­å¾€ä¸‹é“¾å¼è°ƒç”¨
P3 = P2.then(
	//...
)

console.log(P3)




// é¿å…æŠ¥é”™çš„æƒ…å†µ
const P11 = new Promise((resolve,reject)=>{
	reject()
})
P11.then(
	(res)=>{},
	(err)=>{}//ä¸Šé¢æœ‰ reject çš„è¯ï¼Œthen çš„ç¬¬äºŒä¸ªå‡½æ•°å°±ä¸€å®šè¦å†™ï¼å“ªæ€•æ˜¯ç©ºçš„å‡½æ•°ï¼ï¼ä¸€èˆ¬æœ€åŽä¸€ä¸ªéƒ½ä¼šåŠ ï¼
)




//âœˆï¸âœˆï¸âœˆï¸âœˆï¸âœˆï¸ æ”¹å†™å›žè°ƒåœ°ç‹±çš„èŽ·å–æ•°æ®æ–¹å¼ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

const PROMISE_01 = new Promise((resolve,reject)=>{
	getData('https://api.com','info',(data)=>{ //æ–¹æ³•å°±ä¸é‡æ–°å®šä¹‰äº†ï¼Œä¸Šé¢å·²ç»å®šäº†
		resolve(data) //data å˜ä¸º PROMISE_01 çš„å€¼
	})
})

const PROMISE_02 = PROMISE_01.then(
	(res)=>{//æŽ¥æ”¶ resolve(data) å†…çš„ data
		//å¦‚æžœè¦ç»§ç»­ç»™ä¸‹ä¸€ä¸ª then ä¼ é€’æ•°æ®, éœ€è¦ return ä¸€ä¸ª new Promise å®žä¾‹!!
		return new Promise((resolve,reject)=>{
			getData('https://api02.com','info_02',(data_02)=>{ 
				resolve(data_02) //è¿™æ ·æ‰èƒ½ä¼ é€’ç»™ä¸‹ä¸ª then !
			})
		})

	}, 
	(err)=>{}
)

PROMISE_02.then(//ä¸éœ€è¦ä¼ é€’çš„è¯, ç›´æŽ¥ then å°±è¡Œäº†
	(res)=>{
		getData('https://api03.com','info_02',(data_03)=>{
		})
	},
	(err)=>{}
)

console.log(PROMISE_02);






// start
//1
// success




//ðŸ”¥ðŸ”¥ðŸ”¥å®šä¹‰å‡½æ•°çš„è¯, è¦æ‰§è¡ŒåŽæ‰ä¼šè¿”å›ž Promise å®žä¾‹, æ‰ä¼šå¼€å¯ =>... åŽé¢çš„åŒæ­¥ä»£ç ï¼ï¼
const fn = () => (new Promise((resolve,reject)=>{
	resolve('success')
}))
fn().then(
	res=>{console.log(res)}
)
